<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TA05 - MAIN PAGE</title>

  <!-- ✅ Fuente bonita -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="css/styles.css" />
</head>
<body>

  <!-- ✅ Botón hamburguesa -->
  <button class="menu-toggle">☰</button>

  <!-- ✅ Menú lateral -->
  <nav class="sidebar">
    <h2>Menu</h2>
    <ul>
      <li>
        <div class="button-wrap">
          <a href="index.html" class="custom-button"><span>Home</span></a>
          <div class="button-shadow"></div>
        </div>
      </li>
      <li>
        <div class="button-wrap">
          <a href="project1.html" class="custom-button"><span>Project 1</span></a>
          <div class="button-shadow"></div>
        </div>
      </li>
      <li>
        <div class="button-wrap">
          <a href="project2.html" class="custom-button"><span>Project 2</span></a>
          <div class="button-shadow"></div>
        </div>
      </li>
      <li>
        <div class="button-wrap">
          <a href="projects.html" class="custom-button"><span>Projects</span></a>
          <div class="button-shadow"></div>
        </div>
      </li>
      <li>
        <div class="button-wrap">
          <a href="contactar.html" class="custom-button"><span>Contact</span></a>
          <div class="button-shadow"></div>
        </div>
      </li>
      <li>
        <div class="button-wrap">
          <a href="https://github.com/" target="_blank" class="custom-button"><span>Repository</span></a>
          <div class="button-shadow"></div>
        </div>
      </li>
    </ul>
  </nav>

  <!-- ✅ Capçalera -->
  <header class="header-anim">
    <h1>TA05 - MAIN PAGE</h1>
  </header>

  <!-- ✅ Galería -->
  <div class="gallery">

    <!-- Project 1 -->
    <div class="item glass" id="project1">
      <span class="glow"></span>
      <div class="inner">
        <header>
          <img src="img/Project1.png" alt="Image 1" />
          <h2>Project 1</h2>
        </header>
        <footer class="content">
          <p class="description">
            In this presentation we will show you a program compatible with a form that we will also present below, to facilitate the management of a computer technician in charge of devices in a school. The form is designed for anyone who detects an error or failure in any of the systems, so that through the survey they can notify the technician, providing basic information to help organize the work.
          </p>
          <div class="button-wrap">
            <button class="glass project-btn custom-button" onclick="window.location.href='project1.html'">
              <span>Project 1</span>
            </button>
            <div class="button-shadow"></div>
          </div>
        </footer>
      </div>
    </div>

    <!-- Project 2 -->
    <div class="item glass" id="project2">
      <span class="glow"></span>
      <div class="inner">
        <header>
          <img src="img/Project2.png" alt="Image 2" />
          <h2>Project 2</h2>
        </header>
        <footer class="content">
          <p class="description">
            In this work we present a comparison between AMD and Intel. Comparing AMD and Intel is relevant because both are the main competing companies in the processor market for personal computers, laptops, and servers.
          </p>
          <div class="button-wrap">
            <button class="glass project-btn custom-button" onclick="window.location.href='project2.html'">
              <span>Project 2</span>
            </button>
            <div class="button-shadow"></div>
          </div>
        </footer>
      </div>
    </div>

  </div>

  <!-- ✅ Footer -->
  <footer class="main-footer">
    <p><strong>Email:</strong> alex.sampietro.7e9@itb.cat</p>
    <p><strong>Institute:</strong> Institut Tecnològic de Barcelona</p>
    <p><strong>Name:</strong> Alex Sampietro</p>
  </footer>
<!-- Botón de tema arriba a la derecha -->
<div class="theme-toggle" style="position:fixed;top:15px;right:15px;z-index:4000;">
  <input type="checkbox" id="theme-toggle">
  <label>
    <span></span>
  </label>
</div>

<!-- Fondo para transición fade -->
<div id="fade-bg"></div>
<script>
document.addEventListener("DOMContentLoaded", () => {
  // Menú hamburguesa
  const toggle = document.querySelector(".menu-toggle");
  const sidebar = document.querySelector(".sidebar");
  const body = document.body;

  if (toggle && sidebar) {
    toggle.addEventListener("click", () => {
      sidebar.classList.toggle("open");
      body.classList.toggle("menu-open");
    });
  }

  // Cerrar menú al hacer clic fuera
  document.addEventListener("click", (e) => {
    if (sidebar.classList.contains("open") && !sidebar.contains(e.target) && !toggle.contains(e.target)) {
      sidebar.classList.remove("open");
      body.classList.remove("menu-open");
    }
  });

  // Transición fade en los enlaces internos
  document.querySelectorAll('a[href]').forEach(link => {
    if (link.hostname === window.location.hostname && !link.hasAttribute('target')) {
      link.addEventListener('click', function(e) {
        if (link.getAttribute('href').startsWith('#')) return;
        e.preventDefault();
        document.body.classList.add('fade-out');
        setTimeout(() => {
          window.location = link.href;
        }, 400);
      });
    }
  });

  // Pointer tracking for glow effect
  const $cards = document.querySelectorAll(".item");
  $cards.forEach($card => {
    const cardUpdate = (e) => {
      const position = pointerPositionRelativeToElement($card, e);
      const [px, py] = position.pixels;
      const [perx, pery] = position.percent;
      const [dx, dy] = distanceFromCenter($card, px, py);
      const edge = closenessToEdge($card, px, py);
      const angle = angleFromPointerEvent($card, dx, dy);
      $card.style.setProperty('--pointer-x', `${round(perx)}%`);
      $card.style.setProperty('--pointer-y', `${round(pery)}%`);
      $card.style.setProperty('--pointer-°', `${round(angle)}deg`);
      $card.style.setProperty('--pointer-d', `${round(edge * 100)}`);
      $card.classList.remove('animating');
    };
    $card.addEventListener("pointermove", cardUpdate);
  });

  const centerOfElement = ($el) => {
    const { left, top, width, height } = $el.getBoundingClientRect();
    return [width / 2, height / 2];
  };

  const pointerPositionRelativeToElement = ($el, e) => {
    const pos = [e.clientX, e.clientY];
    const { left, top, width, height } = $el.getBoundingClientRect();
    const x = pos[0] - left;
    const y = pos[1] - top;
    const px = clamp((100 / width) * x);
    const py = clamp((100 / height) * y);
    return { pixels: [x, y], percent: [px, py] };
  };

  const angleFromPointerEvent = ($el, dx, dy) => {
    let angleRadians = 0;
    let angleDegrees = 0;
    if (dx !== 0 || dy !== 0) {
      angleRadians = Math.atan2(dy, dx);
      angleDegrees = angleRadians * (180 / Math.PI) + 90;
      if (angleDegrees < 0) {
        angleDegrees += 360;
      }
    }
    return angleDegrees;
  };

  const distanceFromCenter = ($card, x, y) => {
    const [cx, cy] = centerOfElement($card);
    return [x - cx, y - cy];
  };

  const closenessToEdge = ($card, x, y) => {
    const [cx, cy] = centerOfElement($card);
    const [dx, dy] = distanceFromCenter($card, x, y);
    let k_x = Infinity;
    let k_y = Infinity;
    if (dx !== 0) {
      k_x = cx / Math.abs(dx);
    }
    if (dy !== 0) {
      k_y = cy / Math.abs(dy);
    }
    return clamp((1 / Math.min(k_x, k_y)), 0, 1);
  };

  const round = (value, precision = 3) => parseFloat(value.toFixed(precision));

  const clamp = (value, min = 0, max = 100) => Math.min(Math.max(value, min), max);

  setTimeout(() => {
    playAnimation();
  }, 500);

  function easeOutCubic(x) {
    return 1 - Math.pow(1 - x, 3);
  }
  function easeInCubic(x) {
    return x * x * x;
  }

  function animateNumber(options) {
    const {
      startValue = 0,
      endValue = 100,
      duration = 1000,
      delay = 0,
      onUpdate = () => {},
      ease = (t) => t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2,
      onStart = () => {},
      onEnd = () => {},
    } = options;

    const startTime = performance.now() + delay;

    function update() {
      const currentTime = performance.now();
      const elapsed = currentTime - startTime;
      const t = Math.min(elapsed / duration, 1);
      const easedValue = startValue + (endValue - startValue) * ease(t);
      onUpdate(easedValue);

      if (t < 1) {
        requestAnimationFrame(update);
      } else if (t >= 1) {
        onEnd();
      }
    }
    
    setTimeout(() => {
      onStart();
      requestAnimationFrame(update);
    }, delay);
  }

  const playAnimation = () => {
    const $card = $cards[0];
    const angleStart = 110;
    const angleEnd = 465;
    $card.style.setProperty('--pointer-°', `${angleStart}deg`);
    $card.classList.add('animating');
    animateNumber({
      ease: easeOutCubic,
      duration: 500,
      onUpdate: (v) => {
        $card.style.setProperty('--pointer-d', v);
      }
    });
    animateNumber({
      ease: easeInCubic,
      delay: 0,
      duration: 1500,
      endValue: 50,
      onUpdate: (v) => {
        const d = (angleEnd - angleStart) * (v / 100) + angleStart;
        $card.style.setProperty('--pointer-°', `${d}deg`);
      }
    });
    animateNumber({
      ease: easeOutCubic,
      delay: 1500,
      duration: 2250,
      startValue: 50,
      endValue: 100,
      onUpdate: (v) => {
        const d = (angleEnd - angleStart) * (v / 100) + angleStart;
        $card.style.setProperty('--pointer-°', `${d}deg`);
      }
    });
    animateNumber({
      ease: easeInCubic,
      duration: 1500,
      delay: 2500,
      startValue: 100,
      endValue: 0,
      onUpdate: (v) => {
        $card.style.setProperty('--pointer-d', v);
      },
      onEnd: () => {
        $card.classList.remove('animating');
      }
    });
  };

  // Tema claro/oscuro
  const themeToggle = document.getElementById('theme-toggle');
  const themeToggleDiv = document.querySelector('.theme-toggle');
  function setTheme(dark) {
    if (dark) {
      document.body.classList.add('dark-theme');
      themeToggle.checked = true;
      localStorage.setItem('theme', 'dark');
    } else {
      document.body.classList.remove('dark-theme');
      themeToggle.checked = false;
      localStorage.setItem('theme', 'light');
    }
  }
  themeToggleDiv.addEventListener('click', () => {
    themeToggle.checked = !themeToggle.checked;
    setTheme(themeToggle.checked);
  });
  // Mantener tema al recargar
  if (localStorage.getItem('theme') === 'dark') setTheme(true);
});
</script>

</body>
</html>
