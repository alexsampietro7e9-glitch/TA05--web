<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TA05 - MAIN PAGE</title>

  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css" />
</head>

<body>

  <!-- Botón hamburguesa -->
  <button class="menu-toggle">☰</button>

  <!-- Sidebar -->
  <nav class="sidebar glass">
    <h2>Menu</h2>
    <ul>
      <li><a href="project1.html">Project 1</a></li>
      <li><a href="project2.html">Project 2</a></li>
      <li><a href="projects.html">Projects</a></li>
      <li><a href="contactar.html">Contact</a></li>
    </ul>
  </nav>

  <!-- Header -->
  <header class="glass">
    <h1>TA05 - MAIN PAGE</h1>
  </header>

  <!-- Galería -->
  <div class="gallery glass">

    <!-- Project 1 -->
    <div class="item glass" id="project1">
      <span class="glow"></span>
      <div class="inner">
        <header>
          <img src="img/Project1.png" alt="Image 1" />
          <h2>Project 1</h2>
        </header>
        <footer class="content">
          <p class="description">
            In this presentation we will show you a program compatible with a form that we will also present below...
          </p>
          <div class="button-wrap">
            <button class="glass project-btn custom-button" onclick="window.location.href='project1.html'">
              <span>Project 1</span>
            </button>
          </div>
        </footer>
      </div>
    </div>

    <!-- Project 2 -->
    <div class="item glass" id="project2">
      <span class="glow"></span>
      <div class="inner">
        <header>
          <img src="img/Project2.png" alt="Image 2" />
          <h2>Project 2</h2>
        </header>
        <footer class="content">
          <p class="description">
            In this work we present a comparison between AMD and Intel...
          </p>
          <div class="button-wrap">
            <button class="glass project-btn custom-button" onclick="window.location.href='project2.html'">
              <span>Project 2</span>
            </button>
          </div>
        </footer>
      </div>
    </div>

  </div>

  <!-- Footer -->
  <footer class="main-footer glass">
    <p><strong>Email:</strong> alex.sampietro.7e9@itb.cat</p>
    <p><strong>Institute:</strong> Institut Tecnològic de Barcelona</p>
    <p><strong>Name:</strong> Alex Sampietro</p>
  </footer>

  <!-- Toggle de tema -->
  <div class="theme-switch">
    <input type="checkbox" id="theme-toggle">
    <label for="theme-toggle"></label>
  </div>

  <!-- Fondo fade -->
  <div id="fade-bg"></div>

  <!-- SCRIPT -->
  <script>
  document.addEventListener("DOMContentLoaded", () => {

    /* ---------------- MENÚ ---------------- */
    const toggle = document.querySelector(".menu-toggle");
    const sidebar = document.querySelector(".sidebar");
    const body = document.body;

    toggle.addEventListener("click", () => {
      sidebar.classList.toggle("open");
      body.classList.toggle("menu-open");
    });

    /* ---------------- CERRAR MENÚ AL CLICAR FUERA ---------------- */
    document.addEventListener("click", (e) => {
      if (
        sidebar.classList.contains("open") &&
        !sidebar.contains(e.target) &&
        !toggle.contains(e.target)
      ) {
        sidebar.classList.remove("open");
        body.classList.remove("menu-open");
      }
    });

    /* ---------------- FADE LINKS ---------------- */
    document.querySelectorAll('a[href]').forEach(link => {
      if (link.hostname === window.location.hostname && !link.hasAttribute('target')) {
        link.addEventListener('click', function(e) {
          if (link.getAttribute('href').startsWith('#')) return;
          e.preventDefault();
          document.body.classList.add('fade-out');
          setTimeout(() => window.location = link.href, 400);
        });
      }
    });

    /* ---------------- GLOW ADVANCED ---------------- */
    const $cards = document.querySelectorAll(".item");

    const centerOfElement = ($el) => {
      const { width, height } = $el.getBoundingClientRect();
      return [width / 2, height / 2];
    };

    const pointerPositionRelativeToElement = ($el, e) => {
      const { left, top, width, height } = $el.getBoundingClientRect();
      const x = e.clientX - left;
      const y = e.clientY - top;
      return { pixels: [x, y], percent: [(100 / width) * x, (100 / height) * y] };
    };

    const angleFromPointerEvent = ($el, dx, dy) => {
      let angle = Math.atan2(dy, dx) * (180 / Math.PI) + 90;
      return angle < 0 ? angle + 360 : angle;
    };

    const distanceFromCenter = ($card, x, y) => {
      const [cx, cy] = centerOfElement($card);
      return [x - cx, y - cy];
    };

    const closenessToEdge = ($card, x, y) => {
      const [cx, cy] = centerOfElement($card);
      const [dx, dy] = distanceFromCenter($card, x, y);
      const kx = dx !== 0 ? cx / Math.abs(dx) : Infinity;
      const ky = dy !== 0 ? cy / Math.abs(dy) : Infinity;
      return Math.min(1 / Math.min(kx, ky), 1);
    };

    $cards.forEach($card => {
      $card.addEventListener("pointermove", (e) => {
        const pos = pointerPositionRelativeToElement($card, e);
        const [dx, dy] = distanceFromCenter($card, pos.pixels[0], pos.pixels[1]);
        const edge = closenessToEdge($card, pos.pixels[0], pos.pixels[1]);
        const angle = angleFromPointerEvent($card, dx, dy);

        $card.style.setProperty('--pointer-x', `${pos.percent[0]}%`);
        $card.style.setProperty('--pointer-y', `${pos.percent[1]}%`);
        $card.style.setProperty('--pointer-°', `${angle}deg`);
        $card.style.setProperty('--pointer-d', `${edge * 100}`);
      });
    });

    /* ---------------- TEMA CLARO/OSCURO ---------------- */
    const themeToggle = document.getElementById("theme-toggle");

    function setTheme(dark) {
      if (dark) {
        document.body.classList.add("dark-theme");
        themeToggle.checked = true;
        localStorage.setItem("theme", "dark");
      } else {
        document.body.classList.remove("dark-theme");
        themeToggle.checked = false;
        localStorage.setItem("theme", "light");
      }
    }

    themeToggle.addEventListener("change", () => {
      setTheme(themeToggle.checked);
    });

    if (localStorage.getItem("theme") === "dark") {
      setTheme(true);
    }

  });
  </script>

</body>
</html>
